<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <link rel="stylesheet" href="./stylesheets/style.css" />
    <title>Document</title>
    <!-- <script src="../node_modules/echarts/dist/echarts.common.min.js"></script> -->
     <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@4.7.0/dist/echarts.min.js"></script>

  </head>
  <body>
    <h2>新闻内容检索</h2>
    <form>
      <br />
      <input
        type="text"
        name="title_text"
        class="search"
        placeholder="请输入内容"
      />
      <br />
      <br />
      <br />
      <input class="form1" type="checkbox" /><span>title</span>
      <input class="form2" type="checkbox" /><span>keywords</span>
      <input class="form3" type="checkbox" /><span>content</span>
      <input class="form-submit1" type="button" value="查询" />
    </form>

    <!-- 热度分析 -->
    <!-- <a href="localhost:3000/echarts.html">热度分析</a> -->
    <form>
      <br />
      <input
        class="div1"
        type="text"
        name="word"
        placeholder="请输入您想进行时间热度分析的关键词"
      />
      <br />
      <input class="form-submit" type="button" name="timely" value="查询" />
    </form>

    <!-- 表格数据 -->
    <div class="cardLayout" style="margin: 10px 0px">
      <table width="100%" id="record2"></table>
      <div id = "tail">
        当前<input id="current" />页 每页20条 数据总量<input id="sjzl" />
        <a href="#" id="btn1">首页</a>
        <a href="#" id="btn2">上一页</a>
        <a href="#" id="btn3">下一页</a>
        <a href="#" id="btn4">尾页</a>
        转到
        <input id="changePage" type="text" size="1" ,maxlength="5" />
        页
        <a href="#" id="btn5">跳转</a>
      </div>
    </div>

    <!-- 画布 -->
    <div id="main" style="width: 600px; height: 400px"></div> 
        <div id="main" style="width: 600px; height: 400px"></div>

    <!-- <script type="text/javascript">
      // 基于准备好的dom，初始化echarts实例
      var myChart = echarts.init(document.getElementById('main'));

      // 指定图表的配置项和数据
      option = {
  title: {
    text: 'Referer of a Website',
    subtext: 'Fake Data',
    left: 'center'
  },
  tooltip: {
    trigger: 'item'
  },
  legend: {
    orient: 'vertical',
    left: 'left'
  },
  series: [
    {
      name: 'Access From',
      type: 'pie',
      radius: '50%',
      data: [
        { value: 1048, name: 'Search Engine' },
        { value: 735, name: 'Direct' },
        { value: 580, name: 'Email' },
        { value: 484, name: 'Union Ads' },
        { value: 300, name: 'Video Ads' }
      ],
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowOffsetX: 0,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      }
    }
  ]
}; -->
      <!-- myChart.setOption(option);
    </script> -->

    <script>
      $(document).ready(function () {
        
        $(".form-submit1").click(function () {
          var title = $("input.form1").is(":checked");
          var keywords = $("input.form2").is(":checked");
          var content = $("input.form3").is(":checked");
          if (
            title.valueOf() == false &&
            keywords.valueOf() == false &&
            content.valueOf() == false
          ) {
            alert("请至少选择一项作为搜索范围");
            return;
          }
          //  $(".form-submit1").click(function () {

          $.get(
            "/process_get?title=" +
              title +
              "&keywords=" +
              keywords +
              "&content=" +
              content +
              "&words=" +
              $(".search").val(),
            function (data) {
              $("#record2").empty();
              $("#record2").append(
                '<tr class = "cardLayout"><td>source_name</td>' +
                  "<td>title</td><td>publish_date</td></tr>"
              );
              for (let list of data) {
                let table = '<tr class = "cardLayout"><td>';
                table +=
                  list.source_name +
                  "</td><td>" +
                  "<a href=" +
                  list.url +
                  ' target = "_blank">' +
                  list.title +
                  "</a></td><td>" +
                  list.publish_date;
                $("#record2").append(table + "</td></tr>");
              } //for循环结束

              $('#tail').show();

              display();
              function display() {
                var pageSize = 20; // 每页的记录条数
                var curPage = 0; // 当前页数
                var lastPage; //最后页
                var direct = 0; //方向
                var len; //总行数
                var page; //总页数
                var begin;
                var end;

                len = $("#record2 tr").length - 1;
                page =
                  len % pageSize == 0
                    ? len / pageSize
                    : Math.floor(len / pageSize) + 1; //根据记录条数计算页数

                curPage = 1;
                displayPage(); // 显示第一页
                $("#current").val(curPage + "/" + page);
                $("#sjzl").val(len);

                $("#btn1").click(function () {
                  //首页
                  curPage = 1;
                  direct = 0;
                  displayPage();
                });
                $("#btn2").click(function () {
                  // 上一页
                  direct = -1;
                  displayPage();
                });
                $("#btn3").click(function () {
                  //下一页
                  direct = 1;
                  displayPage();
                });
                $("#btn4").click(function () {
                  //尾页
                  curPage = page;
                  direct = 0;
                  displayPage();
                });
                $("#btn5").click(function () {
                  curPage = document.getElementById("changePage").value * 1;
                  if (!/^[1-9]\d*$/.test(curPage)) {
                    alert("请输入正整数");
                    return;
                  }
                  if (curPage > page) {
                    alert("超出数据页面");
                    return;
                  }
                  direct = 0;
                  displayPage();
                });

                function displayPage() {
                  if (curPage <= 1 && direct == -1) {
                    direct = 0;
                    alert("已经是第一页了");
                    return;
                  } else if (curPage >= page && direct == 1) {
                    direct = 0;
                    alert("已经是最后一页了");
                    return;
                  }

                  lastPage = curPage;

                  // 当总行数大于每页的行数时才进行翻页操作
                  if (len > pageSize) {
                    curPage = curPage + direct;
                  } else {
                    curPage = 1;
                  }

                  $("#current").val(curPage + "/" + page);
                  begin = (curPage - 1) * pageSize + 1; //起始记录号
                  end = begin + 1 * pageSize - 1; //末尾记录号

                  if (end > len) end = len;
                  $("#record2 tr").hide();
                  $("#record2 tr").each(function (i) {
                    if ((i >= begin && i <= end) || i == 0) {
                      $(this).show();
                    }
                  });
                }
              }
            }
          );
        });


      });
    </script>
  </body>
</html>
